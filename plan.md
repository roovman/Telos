# üìÖ –ü–õ–ê–ù –†–û–ó–†–û–ë–ö–ò: –ù–∞—Å—Ç—É–ø–Ω–∞ –°–µ—Å—ñ—è

**–ü–æ—Ç–æ—á–Ω–∏–π –°—Ç–∞–Ω:** –Ø–¥—Ä–æ –≥—Ä–∏ (`GameState`, `Map`, `Entity`), –ª–æ–≥—ñ–∫–∞ —Ä—É—Ö—É, –ø—ñ–¥–±–∏—Ä–∞–Ω–Ω—è –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —Ç–∞ —Ä–µ–∂–∏–º –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–∞ —Å—Ç—ñ–Ω —É—Å–ø—ñ—à–Ω–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ç–∞ –ø—Ä–∞—Ü—é—é—Ç—å —É —Ü–∏–∫–ª—ñ.

**–û—Å–Ω–æ–≤–Ω–∞ –ú–µ—Ç–∞:** –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —É **–±–∞–≥–∞—Ç–æ—Ä–µ–∂–∏–º–Ω—É —Å–∏—Å—Ç–µ–º—É (FSM)** –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è, –¥–æ–¥–∞–≤—à–∏ –ì–æ–ª–æ–≤–Ω–µ –ú–µ–Ω—é —Ç–∞ –≤–∏–¥—ñ–ª–µ–Ω–∏–π –†–µ–∂–∏–º –ë—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–∞.

---

## ‚öôÔ∏è –§–∞–∑–∞ 1: –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ FSM (–°–∫—ñ–Ω—á–µ–Ω–Ω–∏–π –ê–≤—Ç–æ–º–∞—Ç –°—Ç–∞–Ω—ñ–≤)

–§–æ–∫—É—Å –Ω–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—ñ —Å—Ç–∞–Ω–æ–º –≤–µ—Ä—Ö–Ω—å–æ–≥–æ —Ä—ñ–≤–Ω—è —É `engine.rs`.

1.  **–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ì–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –°—Ç–∞–Ω—É (`AppState`):**
    * –°—Ç–≤–æ—Ä–∏—Ç–∏ `enum AppState { MainMenu, BuildMode(GameState), GameMode(GameState), Exiting }` —É `src/lib/tui/engine.rs`.
    * `run()` –º–∞—î —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏—Å—è –∑ `AppState::MainMenu`.
2.  **–¶–∏–∫–ª –ö–µ—Ä—É–≤–∞–Ω–Ω—è –°—Ç–∞–Ω–∞–º–∏:**
    * –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `match` –ø–æ `AppState` —É –≥–æ–ª–æ–≤–Ω–æ–º—É —Ü–∏–∫–ª—ñ `run()`.
    * –ö–æ–∂–Ω–∞ –≥—ñ–ª–∫–∞ `match` –ø–æ–≤–∏–Ω–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å–≤—ñ–π –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ–π —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—é –º–∞–ª—é–≤–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `handle_menu_events` —Ç–∞ `draw_menu`).
3.  **–ü–µ—Ä–µ—Ö–æ–¥–∏ –°—Ç–∞–Ω—ñ–≤:**
    * –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ—Ö–æ–¥—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ `AppState::MainMenu` –Ω–∞ `AppState::BuildMode` –ø—ñ—Å–ª—è –≤–∏–±–æ—Ä—É –≤ –º–µ–Ω—é).

---

## üíª –§–∞–∑–∞ 2: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –õ–æ–≥—ñ–∫–∏ —Ç–∞ –¢–∏–ø—ñ–∑–∞—Ü—ñ—è

–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–∏—Ö –¥–ª—è –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ —á–∏—Å—Ç–æ—Ç–∏.

4.  **–ß–∏—Å—Ç–∞ –¢–∏–ø—ñ–∑–∞—Ü—ñ—è ID:**
    * –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª `src/specials/ids.rs`.
    * –í–∏–∑–Ω–∞—á–∏—Ç–∏ **`pub type EntityID = u32;`**.
    * –ó–∞–º—ñ–Ω–∏—Ç–∏ –ø—Ä—è–º–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `u32` –Ω–∞ `EntityID` —É `GameState` —Ç–∞ `Entity` –¥–ª—è **—Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ—ó —è—Å–Ω–æ—Å—Ç—ñ** (–¥–µ —Ü–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ).
5.  **–§—ñ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è –°—É—Ç–Ω–æ—Å—Ç—ñ:**
    * –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `Entity` –º—ñ—Å—Ç–∏—Ç—å —É—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –ø–æ–ª—è (Health, Position, Symbol).
    * –°—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–∑–æ–≤—É –ª–æ–≥—ñ–∫—É –¥–ª—è –≤–æ—Ä–æ–≥—ñ–≤ (–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–æ–Ω–∏ –ø–æ–∫–∏ —â–æ –Ω–µ —Ä—É—Ö–∞—é—Ç—å—Å—è), —â–æ–± –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ “ë—Ä—É–Ω—Ç –¥–ª—è —Ç—Ä–µ–π—Ç—É `AI`.

---

## üé® –§–∞–∑–∞ 3: –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ú–µ–Ω—é —Ç–∞ –§—ñ–¥–±–µ–∫

–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –¥–ª—è –Ω–æ–≤–∏—Ö —Å—Ç–∞–Ω—ñ–≤.

6.  **–ú–∞–ª—é–≤–∞–Ω–Ω—è –ú–µ–Ω—é:**
    * –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `draw_menu()` —É `src/tui/draw.rs`.
    * –ú–µ–Ω—é –º–∞—î –ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –º—ñ–Ω—ñ–º—É–º –¥–≤—ñ –æ–ø—Ü—ñ—ó: `1. –†–µ–∂–∏–º –ë—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–∞`, `2. –ü–æ—á–∞—Ç–∏ –ì—Ä—É`.
7.  **–û–±—Ä–æ–±–∫–∞ –ü–æ–¥—ñ–π –ú–µ–Ω—é:**
    * –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `handle_menu_events()` —É `src/lib/tui/input.rs`, —è–∫–∞ –æ–±—Ä–æ–±–ª—è—Ç–∏–º–µ –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏–º–µ `Action` –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥—É —Å—Ç–∞–Ω—É.
8.  **–í—ñ–∑—É–∞–ª—å–Ω–∏–π –§—ñ–¥–±–µ–∫ –†–µ–∂–∏–º—É:**
    * –£ `draw.rs` –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –Ω–∞–∑–≤—É –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É FSM (Build Mode –∞–±–æ Game Mode) —É –±–ª–æ—Ü—ñ "STATUS / DEBUG" –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.